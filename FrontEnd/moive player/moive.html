<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>John Wick: Chapter 3 - Parabellum | Maxion</title>
    <link rel="stylesheet" href="../moive player/moive.css">
<!--     
    <style>
        
        
    </style> -->
</head>
<body>
    <!-- Notification -->
    <div class="notification" id="notification"></div>

    <!-- Header -->
    <header class="header" id="header">
        <div class="header-content">
            <button class="back-btn" onclick="goBack()">
                <span>‚Üê</span>
                <span>Quay l·∫°i</span>
            </button>
            
            <a href="../index.html" class="logo">MAXION</a>
            <style>
                a{
                     text-decoration: none;
                }
            </style>
            
            <div class="header-actions">
                <button class="action-btn" onclick="toggleTheaterMode()" title="Ch·∫ø ƒë·ªô r·∫°p">
                    <span id="theaterIcon">‚õ∂</span>
                </button>
                <button class="action-btn" onclick="togglePictureInPicture()" title="Picture in Picture">
                    <span>‚ßâ</span>
                </button>
                <button class="action-btn" onclick="toggleQuality()" title="Ch·∫•t l∆∞·ª£ng video">
                    <span>‚öô</span>
                </button>
            </div>
        </div>
    </header>

    <!-- Video Container -->
    <div class="video-container" id="videoContainer">
        <div class="video-player" id="videoPlayer">
            <video class="video-element" id="videoElement" preload="metadata">
                <source src="https://commondatastorage.googleapis.com/gtv-videos-bucket/sample/BigBuckBunny.mp4" type="video/mp4">
                <track kind="captions" src="" srclang="vi" label="Ti·∫øng Vi·ªát">
                <track kind="captions" src="" srclang="en" label="English">
                Tr√¨nh duy·ªát c·ªßa b·∫°n kh√¥ng h·ªó tr·ª£ th·∫ª video.
            </video>

            <!-- Loading Overlay -->
            <div class="loading-overlay" id="loadingOverlay">
                <div class="loading-spinner"></div>
            </div>

            <!-- Quality Selector -->
            <div class="quality-selector" id="qualitySelector">
                <button class="quality-option" onclick="changeQuality('4K')">4K Ultra HD</button>
                <button class="quality-option active" onclick="changeQuality('1080p')">1080p Full HD</button>
                <button class="quality-option" onclick="changeQuality('720p')">720p HD</button>
                <button class="quality-option" onclick="changeQuality('480p')">480p</button>
                <button class="quality-option" onclick="changeQuality('360p')">360p</button>
                <button class="quality-option" onclick="changeQuality('auto')">T·ª± ƒë·ªông</button>
            </div>

            <!-- Video Controls -->
            <div class="video-controls" id="videoControls">
                <div class="progress-container" id="progressContainer">
                    <div class="progress-bar">
                        <div class="progress-filled" id="progressFilled"></div>
                        <div class="progress-thumb" id="progressThumb"></div>
                    </div>
                </div>

                <div class="controls-bottom">
                    <div class="controls-left">
                        <button class="control-btn play-btn" id="playPauseBtn" onclick="togglePlayPause()">
                            <span id="playIcon">‚ñ∂</span>
                        </button>
                        
                        <div class="volume-container">
                            <button class="control-btn" id="muteBtn" onclick="toggleMute()">
                                <span id="volumeIcon">üîä</span>
                            </button>
                            <div class="volume-slider" id="volumeSlider">
                                <div class="volume-filled" id="volumeFilled"></div>
                            </div>
                        </div>

                        <div class="time-display" id="timeDisplay">
                            00:00 / 00:00
                        </div>
                    </div>

                    <div class="controls-right">
                        <button class="control-btn" onclick="changePlaybackSpeed()" title="T·ªëc ƒë·ªô ph√°t">
                            <span id="speedIcon">1x</span>
                        </button>
                        
                        <button class="control-btn" onclick="toggleSubtitles()" title="Ph·ª• ƒë·ªÅ">
                            <span>CC</span>
                        </button>
                        
                        <button class="control-btn" onclick="toggleFullscreen()" title="To√†n m√†n h√¨nh">
                            <span id="fullscreenIcon">‚õ∂</span>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Picture in Picture Container -->
    <div class="pip-container" id="pipContainer">
        <video class="pip-video" id="pipVideo"></video>
        <div class="pip-controls">
            <button class="pip-btn" onclick="closePiP()">√ó</button>
        </div>
    </div>

    <!-- Content Section -->
    <div class="content-section" id="contentSection">
        <div class="movie-info">
            <div class="movie-details">
                <h1>John Wick: Chapter 3 - Parabellum</h1>
                
                <div class="movie-meta">
                    <div class="meta-item rating">
                        <span>‚≠ê</span>
                        <span>7.4</span>
                    </div>
                    <div class="meta-item">
                        <span>üìÖ</span>
                        <span>2019</span>
                    </div>
                    <div class="meta-item">
                        <span>‚è±Ô∏è</span>
                        <span>2h 11ph√∫t</span>
                    </div>
                    <div class="meta-item">
                        <span>üé¨</span>
                        <span>H√†nh ƒë·ªông, Thriller</span>
                    </div>
                    <div class="meta-item">
                        <span>üîû</span>
                        <span>R - 17+</span>
                    </div>
                </div>

                <p class="description">
                    John Wick b·ªã truy n√£ v·ªõi m·ª©c ti·ªÅn th∆∞·ªüng 14 tri·ªáu ƒë√¥ la tr√™n ƒë·∫ßu v√† m·ªôt ƒë·ªôi qu√¢n s√°t th·ªß ƒëang truy ƒëu·ªïi anh ta. Sau khi gi·∫øt m·ªôt th√†nh vi√™n c·ªßa High Table - t·ªï ch·ª©c s√°t th·ªß b√≠ m·∫≠t qu·ªëc t·∫ø, John Wick b·ªã tr·ª•c xu·∫•t kh·ªèi m·ªçi d·ªãch v·ª• v√† c·∫£nh b√°o trong ng√†nh. Anh ta ph·∫£i chi·∫øn ƒë·∫•u ƒë·ªÉ tho√°t kh·ªèi New York khi m√† c√°c s√°t th·ªß gi·ªèi nh·∫•t th·∫ø gi·ªõi ƒëang sƒÉn l√πng anh.
                </p>
                <div id="episode-list">
    <h2>Danh s√°ch t·∫≠p</h2>
    <div id="episodes-container"></div>
</div>

<script>
    const cartoonId = 1; // Thay ƒë·ªïi ID theo cartoon

    fetch(`/api/episodes/cartoon/${cartoonId}`)
        .then(res => res.json())
        .then(episodes => {
            const container = document.getElementById('episodes-container');

            // N·∫øu ch∆∞a c√≥ t·∫≠p n√†o, t·∫°o danh s√°ch "placeholder" (gi·∫£)
            if (episodes.length === 0) {
                for (let i = 1; i <= 10; i++) {
                    const epDiv = document.createElement('div');
                    epDiv.className = 'episode-item disabled';
                    epDiv.innerHTML = `<strong>T·∫≠p ${i}:</strong> Ch∆∞a c√≥ d·ªØ li·ªáu`;
                    container.appendChild(epDiv);
                }
            } else {
                // C√≥ d·ªØ li·ªáu th·∫≠t t·ª´ DB
                episodes.sort((a, b) => a.episode_number - b.episode_number);
                episodes.forEach(ep => {
                    const epDiv = document.createElement('div');
                    epDiv.className = 'episode-item';
                    epDiv.innerHTML = `
                        <strong>T·∫≠p ${ep.episode_number}:</strong> ${ep.title}<br>
                        <a href="${ep.video_url}" target="_blank">Xem ngay</a>
                    `;
                    container.appendChild(epDiv);
                });
            }
        })
        .catch(err => {
            console.error("L·ªói khi t·∫£i danh s√°ch t·∫≠p:", err);
            document.getElementById('episodes-container').innerText = "Kh√¥ng th·ªÉ t·∫£i danh s√°ch t·∫≠p.";
        });
</script>


                <div class="movie-actions">
                    <button class="action-button btn-primary" onclick="restartMovie()">
                        <span>üîÑ</span>
                        Xem l·∫°i t·ª´ ƒë·∫ßu
                    </button>
                    <button class="action-button btn-secondary" onclick="addToWatchlist()">
                        <span>‚ù§Ô∏è</span>
                        Th√™m v√†o y√™u th√≠ch
                    </button>
                    <button class="action-button btn-secondary" onclick="downloadMovie()">
                        <span>üì•</span>
                        T·∫£i xu·ªëng
                    </button>
                    <button class="action-button btn-secondary" onclick="shareMovie()">
                        <span>üì§</span>
                        Chia s·∫ª
                    </button>
                </div>

                <div class="cast-crew">
                    <h3>Di·ªÖn vi√™n & ƒê·∫°o di·ªÖn</h3>
                    <div class="cast-list">
                        <div class="cast-member">
                            <div class="cast-avatar">KR</div>
                            <div class="cast-name">Keanu Reeves</div>
                        </div>
                        <div class="cast-member">
                            <div class="cast-avatar">HB</div>
                            <div class="cast-name">Halle Berry</div>
                        </div>
                        <div class="cast-member">
                            <div class="cast-avatar">IM</div>
                            <div class="cast-name">Ian McShane</div>
                        </div>
                        <div class="cast-member">
                            <div class="cast-avatar">LF</div>
                            <div class="cast-name">Laurence Fishburne</div>
                        </div>
                        <div class="cast-member">
                            <div class="cast-avatar">CS</div>
                            <div class="cast-name">Chad Stahelski</div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="sidebar">
                <h3>Phim li√™n quan</h3>
                <div class="related-movies">
                    <div class="related-movie" onclick="playRelatedMovie('john-wick-1')">
                        <div class="related-poster">JW1</div>
                        <div class="related-info">
                            <h4>John Wick</h4>
                            <p>2014 ‚Ä¢ 1h 41ph√∫t</p>
                            <div class="related-rating">
                                <span>‚≠ê</span>
                                <span>7.4</span>
                            </div>
                        </div>
                    </div>

                    <div class="related-movie" onclick="playRelatedMovie('john-wick-2')">
                        <div class="related-poster">JW2</div>
                        <div class="related-info">
                            <h4>John Wick: Chapter 2</h4>
                            <p>2017 ‚Ä¢ 2h 2ph√∫t</p>
                            <div class="related-rating">
                                <span>‚≠ê</span>
                                <span>7.5</span>
                            </div>
                        </div>
                    </div>

                    <div class="related-movie" onclick="playRelatedMovie('john-wick-4')">
                        <div class="related-poster">JW4</div>
                        <div class="related-info">
                            <h4>John Wick: Chapter 4</h4>
                            <p>2023 ‚Ä¢ 2h 49ph√∫t</p>
                            <div class="related-rating">
                                <span>‚≠ê</span>
                                <span>7.7</span>
                            </div>
                        </div>
                    </div>

                    <div class="related-movie" onclick="playRelatedMovie('nobody')">
                        <div class="related-poster">NBD</div>
                        <div class="related-info">
                            <h4>Nobody</h4>
                            <p>2021 ‚Ä¢ 1h 32ph√∫t</p>
                            <div class="related-rating">
                                <span>‚≠ê</span>
                                <span>7.4</span>
                            </div>
                        </div>
                    </div>

                    <div class="related-movie" onclick="playRelatedMovie('atomic-blonde')">
                        <div class="related-poster">AB</div>
                        <div class="related-info">
                            <h4>Atomic Blonde</h4>
                            <p>2017 ‚Ä¢ 1h 55ph√∫t</p>
                            <div class="related-rating">
                                <span>‚≠ê</span>
                                <span>6.7</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Comments Section -->
        <div class="comments-section">
            <div class="comments-header">
                <h3>B√¨nh lu·∫≠n (847)</h3>
                <select style="background: var(--secondary-bg); color: var(--text-primary); border: 1px solid rgba(255,255,255,0.2); padding: 8px; border-radius: 6px;">
                    <option>M·ªõi nh·∫•t</option>
                    <option>C≈© nh·∫•t</option>
                    <option>Ph·ªï bi·∫øn nh·∫•t</option>
                </select>
            </div>

            <div class="comment-form">
                <textarea class="comment-input" placeholder="Vi·∫øt b√¨nh lu·∫≠n c·ªßa b·∫°n..."></textarea>
                <div class="comment-actions">
                    <button class="action-button btn-primary" onclick="postComment()">ƒêƒÉng b√¨nh lu·∫≠n</button>
                </div>
            </div>

            <div class="comments-list">
                <div class="comment">
                    <div class="comment-avatar">AN</div>
                    <div class="comment-content">
                        <div class="comment-header">
                            <span class="comment-author">Anh Nguy·ªÖn</span>
                            <span class="comment-time">2 gi·ªù tr∆∞·ªõc</span>
                        </div>
                        <div class="comment-text">
                            Phim hay tuy·ªát v·ªùi! John Wick 3 th·ª±c s·ª± kh√¥ng l√†m t√¥i th·∫•t v·ªçng. Nh·ªØng pha h√†nh ƒë·ªông m√£n nh√£n v√† k·ªãch b·∫£n ch·∫∑t ch·∫Ω. Keanu Reeves th·∫≠t s·ª± ƒë√£ th·ªÉ hi·ªán xu·∫•t s·∫Øc vai di·ªÖn n√†y.
                        </div>
                        <div class="comment-actions-list">
                            <button class="comment-action">
                                <span>üëç</span>
                                <span>124</span>
                            </button>
                            <button class="comment-action">
                                <span>üëé</span>
                                <span>5</span>
                            </button>
                            <button class="comment-action">Tr·∫£ l·ªùi</button>
                        </div>
                    </div>
                </div>

                <div class="comment">
                    <div class="comment-avatar">MT</div>
                    <div class="comment-content">
                        <div class="comment-header">
                            <span class="comment-author">Minh Tr·∫ßn</span>
                            <span class="comment-time">5 gi·ªù tr∆∞·ªõc</span>
                        </div>
                        <div class="comment-text">
                            T√¥i ƒë√£ xem c·∫£ series John Wick v√† ph·∫ßn n√†y th·ª±c s·ª± l√† ƒë·ªânh cao. Nh·ªØng pha ƒë√°nh ƒë·∫•m ƒë∆∞·ª£c choreograph c·ª±c k·ª≥ tinh t·∫ø v√† chuy√™n nghi·ªáp.
                        </div>
                        <div class="comment-actions-list">
                            <button class="comment-action">
                                <span>üëç</span>
                                <span>89</span>
                            </button>
                            <button class="comment-action">
                                <span>üëé</span>
                                <span>2</span>
                            </button>
                            <button class="comment-action">Tr·∫£ l·ªùi</button>
                        </div>
                    </div>
                </div>

                <div class="comment">
                    <div class="comment-avatar">HL</div>
                    <div class="comment-content">
                        <div class="comment-header">
                            <span class="comment-author">H∆∞∆°ng Ly</span>
                            <span class="comment-time">1 ng√†y tr∆∞·ªõc</span>
                        </div>
                        <div class="comment-text">
                            Ch·∫•t l∆∞·ª£ng 4K tr√™n Maxion th·∫≠t s·ª± tuy·ªát v·ªùi! H√¨nh ·∫£nh r·∫•t s·∫Øc n√©t v√† √¢m thanh s·ªëng ƒë·ªông. X·ª©ng ƒë√°ng v·ªõi t·ª´ng ƒë·ªìng ƒë√£ tr·∫£.
                        </div>
                        <div class="comment-actions-list">
                            <button class="comment-action">
                                <span>üëç</span>
                                <span>67</span>
                            </button>
                            <button class="comment-action">
                                <span>üëé</span>
                                <span>1</span>
                            </button>
                            <button class="comment-action">Tr·∫£ l·ªùi</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        'use strict';

        // DOM Elements
        const video = document.getElementById('videoElement');
        const playPauseBtn = document.getElementById('playPauseBtn');
        const playIcon = document.getElementById('playIcon');
        const progressContainer = document.getElementById('progressContainer');
        const progressFilled = document.getElementById('progressFilled');
        const progressThumb = document.getElementById('progressThumb');
        const timeDisplay = document.getElementById('timeDisplay');
        const volumeSlider = document.getElementById('volumeSlider');
        const volumeFilled = document.getElementById('volumeFilled');
        const volumeIcon = document.getElementById('volumeIcon');
        const muteBtn = document.getElementById('muteBtn');
        const fullscreenIcon = document.getElementById('fullscreenIcon');
        const speedIcon = document.getElementById('speedIcon');
        const videoControls = document.getElementById('videoControls');
        const videoPlayer = document.getElementById('videoPlayer');
        const videoContainer = document.getElementById('videoContainer');
        const loadingOverlay = document.getElementById('loadingOverlay');
        const qualitySelector = document.getElementById('qualitySelector');
        const header = document.getElementById('header');
        const theaterIcon = document.getElementById('theaterIcon');
        const contentSection = document.getElementById('contentSection');
        const pipContainer = document.getElementById('pipContainer');
        const pipVideo = document.getElementById('pipVideo');
        const notification = document.getElementById('notification');

        // Video State
        let isPlaying = false;
        let isMuted = false;
        let currentVolume = 0.7;
        let currentSpeed = 1;
        let isTheaterMode = false;
        let isPiPActive = false;
        let controlsTimeout;
        let isFullscreen = false;
        let subtitlesEnabled = false;

        // Playback speeds
        const playbackSpeeds = [0.25, 0.5, 0.75, 1, 1.25, 1.5, 1.75, 2];
        let currentSpeedIndex = 3; // 1x

        // Initialize video player
        document.addEventListener('DOMContentLoaded', function() {
            initializePlayer();
            setupEventListeners();
            
            // Show loading
            showLoading();
            
            // Hide loading when video is ready
            video.addEventListener('canplay', hideLoading);
            video.addEventListener('loadedmetadata', updateDuration);
        });

        function initializePlayer() {
            video.volume = currentVolume;
            updateVolumeDisplay();
            updateSpeedDisplay();
            
            // Set initial state
            video.currentTime = 0;
            updateProgress();
        }

        function setupEventListeners() {
            // Video events
            video.addEventListener('loadstart', showLoading);
            video.addEventListener('canplay', hideLoading);
            video.addEventListener('waiting', showLoading);
            video.addEventListener('playing', hideLoading);
            video.addEventListener('timeupdate', updateProgress);
            video.addEventListener('ended', onVideoEnded);
            video.addEventListener('play', () => {
                isPlaying = true;
                playIcon.textContent = '‚è∏';
            });
            video.addEventListener('pause', () => {
                isPlaying = false;
                playIcon.textContent = '‚ñ∂';
            });

            // Progress bar
            progressContainer.addEventListener('click', seek);
            progressContainer.addEventListener('mousemove', showProgressPreview);

            // Volume control
            volumeSlider.addEventListener('click', setVolume);

            // Controls visibility
            videoPlayer.addEventListener('mouseenter', showControls);
            videoPlayer.addEventListener('mouseleave', hideControlsDelayed);
            videoPlayer.addEventListener('mousemove', showControls);

            // Keyboard shortcuts
            document.addEventListener('keydown', handleKeyboard);

            // Click to play/pause
            video.addEventListener('click', togglePlayPause);

            // Auto-hide header when playing
            video.addEventListener('play', () => {
                if (isPlaying) {
                    setTimeout(() => {
                        if (isPlaying && !videoPlayer.matches(':hover')) {
                            header.classList.add('hidden');
                        }
                    }, 3000);
                }
            });

            video.addEventListener('pause', () => {
                header.classList.remove('hidden');
            });

            // Fullscreen change
            document.addEventListener('fullscreenchange', updateFullscreenIcon);
        }

        // Playback controls
        function togglePlayPause() {
            if (video.paused) {
                video.play();
                showNotification('ƒêang ph√°t video', 'success');
            } else {
                video.pause();
                showNotification('ƒê√£ t·∫°m d·ª´ng', 'success');
            }
        }

        function seek(e) {
            const rect = progressContainer.getBoundingClientRect();
            const clickX = e.clientX - rect.left;
            const newTime = (clickX / rect.width) * video.duration;
            video.currentTime = newTime;
        }

        function updateProgress() {
            if (video.duration) {
                const progress = (video.currentTime / video.duration) * 100;
                progressFilled.style.width = `${progress}%`;
                progressThumb.style.left = `${progress}%`;
                
                // Update time display
                const current = formatTime(video.currentTime);
                const duration = formatTime(video.duration);
                timeDisplay.textContent = `${current} / ${duration}`;
            }
        }

        function updateDuration() {
            const duration = formatTime(video.duration);
            timeDisplay.textContent = `00:00 / ${duration}`;
        }

        function formatTime(seconds) {
            const hours = Math.floor(seconds / 3600);
            const minutes = Math.floor((seconds % 3600) / 60);
            const secs = Math.floor(seconds % 60);
            
            if (hours > 0) {
                return `${hours}:${minutes.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
            } else {
                return `${minutes}:${secs.toString().padStart(2, '0')}`;
            }
        }

        // Volume controls
        function toggleMute() {
            if (isMuted) {
                video.volume = currentVolume;
                isMuted = false;
                volumeIcon.textContent = 'üîä';
            } else {
                currentVolume = video.volume;
                video.volume = 0;
                isMuted = true;
                volumeIcon.textContent = 'üîá';
            }
            updateVolumeDisplay();
        }

        function setVolume(e) {
            const rect = volumeSlider.getBoundingClientRect();
            const clickX = e.clientX - rect.left;
            const newVolume = Math.max(0, Math.min(1, clickX / rect.width));
            
            video.volume = newVolume;
            currentVolume = newVolume;
            isMuted = false;
            
            updateVolumeDisplay();
            updateVolumeIcon();
        }

        function updateVolumeDisplay() {
            const volumePercent = isMuted ? 0 : (video.volume * 100);
            volumeFilled.style.width = `${volumePercent}%`;
        }

        function updateVolumeIcon() {
            if (isMuted || video.volume === 0) {
                volumeIcon.textContent = 'üîá';
            } else if (video.volume < 0.5) {
                volumeIcon.textContent = 'üîâ';
            } else {
                volumeIcon.textContent = 'üîä';
            }
        }

        // Playback speed
        function changePlaybackSpeed() {
            currentSpeedIndex = (currentSpeedIndex + 1) % playbackSpeeds.length;
            currentSpeed = playbackSpeeds[currentSpeedIndex];
            video.playbackRate = currentSpeed;
            updateSpeedDisplay();
            showNotification(`T·ªëc ƒë·ªô ph√°t: ${currentSpeed}x`, 'success');
        }

        function updateSpeedDisplay() {
            speedIcon.textContent = `${currentSpeed}x`;
        }

        // Fullscreen
        function toggleFullscreen() {
            if (!document.fullscreenElement) {
                videoContainer.requestFullscreen().catch(err => {
                    console.log('Error entering fullscreen:', err);
                });
            } else {
                document.exitFullscreen();
            }
        }

        function updateFullscreenIcon() {
            isFullscreen = !!document.fullscreenElement;
            fullscreenIcon.textContent = isFullscreen ? '‚õ∂' : '‚õ∂';
        }

        // Theater mode
        function toggleTheaterMode() {
            isTheaterMode = !isTheaterMode;
            document.body.classList.toggle('theater-mode', isTheaterMode);
            theaterIcon.textContent = isTheaterMode ? '‚õ∂' : '‚õ∂';
            
            if (isTheaterMode) {
                showNotification('ƒê√£ b·∫≠t ch·∫ø ƒë·ªô r·∫°p', 'success');
            } else {
                showNotification('ƒê√£ t·∫Øt ch·∫ø ƒë·ªô r·∫°p', 'success');
            }
        }

        // Picture in Picture
        function togglePictureInPicture() {
            if (!isPiPActive) {
                if (document.pictureInPictureEnabled) {
                    video.requestPictureInPicture()
                        .then(() => {
                            isPiPActive = true;
                            showNotification('ƒê√£ b·∫≠t Picture in Picture', 'success');
                        })
                        .catch(err => {
                            console.log('PiP error:', err);
                            showNotification('Kh√¥ng th·ªÉ b·∫≠t Picture in Picture', 'error');
                        });
                } else {
                    // Fallback PiP implementation
                    enableCustomPiP();
                }
            } else {
                if (document.pictureInPictureElement) {
                    document.exitPictureInPicture();
                } else {
                    disableCustomPiP();
                }
            }
        }

        function enableCustomPiP() {
            pipContainer.classList.add('active');
            pipVideo.src = video.src;
            pipVideo.currentTime = video.currentTime;
            if (isPlaying) {
                pipVideo.play();
            }
            isPiPActive = true;
            showNotification('ƒê√£ b·∫≠t Picture in Picture', 'success');
        }

        function disableCustomPiP() {
            pipContainer.classList.remove('active');
            isPiPActive = false;
            showNotification('ƒê√£ t·∫Øt Picture in Picture', 'success');
        }

        function closePiP() {
            disableCustomPiP();
        }

        // Quality selector
        function toggleQuality() {
            qualitySelector.classList.toggle('active');
        }

        function changeQuality(quality) {
            const currentTime = video.currentTime;
            const wasPlaying = !video.paused;
            
            // Update active quality option
            document.querySelectorAll('.quality-option').forEach(option => {
                option.classList.remove('active');
            });
            event.target.classList.add('active');
            
            // In a real app, you would change the video source here
            showNotification(`ƒê√£ chuy·ªÉn sang ch·∫•t l∆∞·ª£ng ${quality}`, 'success');
            qualitySelector.classList.remove('active');
            
            // Restore playback state
            video.currentTime = currentTime;
            if (wasPlaying) {
                video.play();
            }
        }

        // Subtitles
        function toggleSubtitles() {
            subtitlesEnabled = !subtitlesEnabled;
            
            if (subtitlesEnabled) {
                // Enable subtitles
                if (video.textTracks.length > 0) {
                    video.textTracks[0].mode = 'showing';
                }
                showNotification('ƒê√£ b·∫≠t ph·ª• ƒë·ªÅ', 'success');
            } else {
                // Disable subtitles
                Array.from(video.textTracks).forEach(track => {
                    track.mode = 'hidden';
                });
                showNotification('ƒê√£ t·∫Øt ph·ª• ƒë·ªÅ', 'success');
            }
        }

        // Controls visibility
        function showControls() {
            videoControls.classList.add('visible');
            clearTimeout(controlsTimeout);
            
            controlsTimeout = setTimeout(() => {
                if (isPlaying && !videoPlayer.matches(':hover')) {
                    hideControls();
                }
            }, 3000);
        }

        function hideControls() {
            videoControls.classList.remove('visible');
        }

        function hideControlsDelayed() {
            clearTimeout(controlsTimeout);
            controlsTimeout = setTimeout(hideControls, 1000);
        }

        // Loading
        function showLoading() {
            loadingOverlay.classList.remove('hidden');
        }

        function hideLoading() {
            loadingOverlay.classList.add('hidden');
        }

        // Video ended
        function onVideoEnded() {
            showNotification('Video ƒë√£ k·∫øt th√∫c', 'success');
            // Auto-play next episode or related video
            setTimeout(() => {
                showNotification('ƒêang t·ª± ƒë·ªông ph√°t video ti·∫øp theo...', 'success');
            }, 3000);
        }

        // Keyboard shortcuts
        function handleKeyboard(e) {
            // Prevent default browser shortcuts when video is focused
            if (document.activeElement === video || e.target.closest('.video-player')) {
                switch(e.code) {
                    case 'Space':
                        e.preventDefault();
                        togglePlayPause();
                        break;
                    case 'ArrowLeft':
                        e.preventDefault();
                        video.currentTime -= 10;
                        showNotification('Tua l√πi 10 gi√¢y', 'success');
                        break;
                    case 'ArrowRight':
                        e.preventDefault();
                        video.currentTime += 10;
                        showNotification('Tua t·ªõi 10 gi√¢y', 'success');
                        break;
                    case 'ArrowUp':
                        e.preventDefault();
                        video.volume = Math.min(1, video.volume + 0.1);
                        updateVolumeDisplay();
                        updateVolumeIcon();
                        break;
                    case 'ArrowDown':
                        e.preventDefault();
                        video.volume = Math.max(0, video.volume - 0.1);
                        updateVolumeDisplay();
                        updateVolumeIcon();
                        break;
                    case 'KeyM':
                        e.preventDefault();
                        toggleMute();
                        break;
                    case 'KeyF':
                        e.preventDefault();
                        toggleFullscreen();
                        break;
                    case 'KeyT':
                        e.preventDefault();
                        toggleTheaterMode();
                        break;
                    case 'KeyC':
                        e.preventDefault();
                        toggleSubtitles();
                        break;
                }
            }
        }

        // Navigation functions
        function goBack() {
            // In a real app, this would navigate back to the previous page
            showNotification('ƒêang quay l·∫°i trang tr∆∞·ªõc...', 'success');
            setTimeout(() => {
                window.history.back();
            }, 1000);
        }

        // Movie actions
        function restartMovie() {
            video.currentTime = 0;
            video.play();
            showNotification('ƒêang ph√°t l·∫°i t·ª´ ƒë·∫ßu', 'success');
        }

        function addToWatchlist() {
            showNotification('ƒê√£ th√™m v√†o danh s√°ch y√™u th√≠ch', 'success');
        }

        function downloadMovie() {
            showNotification('B·∫Øt ƒë·∫ßu t·∫£i xu·ªëng...', 'success');
        }

        function shareMovie() {
            if (navigator.share) {
                navigator.share({
                    title: 'John Wick: Chapter 3 - Parabellum',
                    text: 'Xem phim hay tr√™n Maxion',
                    url: window.location.href
                });
            } else {
                navigator.clipboard.writeText(window.location.href);
                showNotification('ƒê√£ sao ch√©p li√™n k·∫øt', 'success');
            }
        }

        function playRelatedMovie(movieId) {
            showNotification(`ƒêang t·∫£i ${movieId}...`, 'success');
            // In a real app, this would load the selected movie
        }

        // Comments
        function postComment() {
            const commentInput = document.querySelector('.comment-input');
            const comment = commentInput.value.trim();
            
            if (comment) {
                showNotification('ƒê√£ ƒëƒÉng b√¨nh lu·∫≠n', 'success');
                commentInput.value = '';
            } else {
                showNotification('Vui l√≤ng nh·∫≠p n·ªôi dung b√¨nh lu·∫≠n', 'error');
            }
        }

        // Notification system
        function showNotification(message, type = 'success') {
            notification.textContent = message;
            notification.className = `notification ${type} show`;
            
            setTimeout(() => {
                notification.classList.remove('show');
            }, 3000);
        }

        // Progress preview (hover)
        function showProgressPreview(e) {
            // In a real app, this would show thumbnail preview
            const rect = progressContainer.getBoundingClientRect();
            const clickX = e.clientX - rect.left;
            const previewTime = (clickX / rect.width) * video.duration;
            
            // You could show a tooltip with the time here
        }

        // Auto-hide header on scroll
        let lastScrollY = 0;
        window.addEventListener('scroll', () => {
            const currentScrollY = window.scrollY;
            
            if (currentScrollY > lastScrollY && currentScrollY > 100) {
                header.classList.add('hidden');
            } else {
                header.classList.remove('hidden');
            }
            
            lastScrollY = currentScrollY;
        });

        // Click outside to close quality selector
        document.addEventListener('click', (e) => {
            if (!e.target.closest('.quality-selector') && !e.target.closest('[onclick*="toggleQuality"]')) {
                qualitySelector.classList.remove('active');
            }
        });

        // Initialize focus for keyboard controls
        videoPlayer.setAttribute('tabindex', '0');
        videoPlayer.focus();
    </script>
</body>
</html>