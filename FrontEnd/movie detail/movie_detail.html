<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Demon Slayer - MAXION</title>
    <link rel="stylesheet" href="./style.css">
    <link rel="stylesheet" href="./enhanced-style.css">
    <link rel="stylesheet" href="movie_detail.css">
</head>
<body class="dark-mode"> <!-- Default to dark-mode, script.js might handle theme preference -->
     <!-- Header Include -->
    <iframe 
        id="header-iframe" 
        src="../header.html" 
        style="width: 100%; border: none; position: fixed; top: 0; z-index: 1000;" 
        onload="adjustIframeHeight(this); syncThemeWithIframe();"
        title="Header Navigation"
        loading="eager">
    </iframe>

    <!-- Movie Detail Hero -->
    <section class="movie-detail-hero" style="margin-top: 60px;"> <!-- Adjusted margin-top for fixed header -->
        <img src="/api/placeholder/1200/500" alt="Demon Slayer Banner" class="movie-detail-hero-img">
        <div class="movie-detail-overlay">
            <div class="container">
                <h1 style="color: white; font-size: 3rem; margin-bottom: 20px;">Demon Slayer</h1>
                <p style="color: white; opacity: 0.9; max-width: 600px; margin-bottom: 30px;">
                    Thanh gươm diệt quỷ (鬼滅の刃 Kimetsu no Yaiba) kể về câu chuyện của Tanjiro Kamado, một thiếu niên trở thành thợ săn quỷ để tìm cách biến em gái của mình trở lại thành người.
                </p>
            </div>
        </div>
    </section>

    <!-- Movie Detail Content -->
    <section class="movie-detail-content">
        <div class="container">
            <div class="movie-info-grid">
                <div class="movie-poster-container">
                    <img src="/api/placeholder/300/450" alt="Demon Slayer Poster" class="movie-poster-lg">
                    <div class="play-trailer-btn">▶</div>
                </div>
                <div class="movie-info-main">
                    <h1>Demon Slayer</h1>
                    <div class="movie-meta-info">
                        <span>2023</span>
                        <span>24 tập</span>
                        <span>TV Series</span>
                        <span>25 phút</span>
                        <span>13+</span>
                    </div>
                    <div class="movie-rating">
                        <span class="stars">★★★★★</span>
                        <span>9.2/10</span>
                        <span>(2.5k đánh giá)</span>
                    </div>
                    <div class="action-buttons">
                        <button class="btn btn-primary btn-lg">▶ Xem ngay</button>
                        <button class="btn btn-outline btn-lg">+ Thêm vào danh sách</button>
                        <button class="btn btn-outline btn-lg">Chia sẻ</button>
                    </div>
                    
                    <div class="tabs">
                        <div class="tab active" data-tab="overview">Tổng quan</div>
                        <div class="tab" data-tab="episodes">Tập phim</div>
                        <div class="tab" data-tab="cast">Diễn viên</div>
                        <div class="tab" data-tab="reviews">Đánh giá</div>
                    </div>
                    
                    <div class="tab-content active" id="overview">
                        <h3>Nội dung phim</h3>
                        <p>
                            Kimetsu no Yaiba, hay còn được biết đến với cái tên Thanh Gươm Diệt Quỷ, kể về câu chuyện của Kamado Tanjiro, một cậu bé sống cùng gia đình ở vùng núi hẻo lánh. Một ngày nọ, khi trở về nhà sau chuyến đi bán than, Tanjiro phát hiện cả gia đình mình đã bị quỷ sát hại, chỉ còn em gái Nezuko sống sót nhưng đã bị biến thành quỷ.
                        </p>
                        <p>
                            Không chấp nhận sự thật rằng em gái mình là quỷ, Tanjiro quyết tâm tìm cách chữa trị cho Nezuko. Cậu được Urokodaki Sakonji, một thợ săn quỷ đã nghỉ hưu, huấn luyện và sau đó tham gia vào Đội Diệt Quỷ. Mục tiêu của Tanjiro là tiêu diệt Quỷ Vương Kibutsuji Muzan - kẻ đã biến em gái cậu thành quỷ và sát hại gia đình cậu, đồng thời tìm cách biến Nezuko trở lại thành người.
                        </p>
                        <p>
                            Trên hành trình của mình, Tanjiro kết bạn với nhiều thợ săn quỷ khác như Zenitsu Agatsuma và Inosuke Hashibira, cùng nhau họ chiến đấu chống lại các con quỷ và dần tiến gần hơn đến Quỷ Vương Muzan.
                        </p>
                        
                        <h3>Thể loại</h3>
                        <div class="categories-list" style="justify-content: flex-start; margin-top: 15px;">
                            <div class="category-item">Hành động</div>
                            <div class="category-item">Phiêu lưu</div>
                            <div class="category-item">Fantasy</div>
                            <div class="category-item">Shonen</div>
                            <div class="category-item">Siêu nhiên</div>
                        </div>
                        
                        <h3 style="margin-top: 30px;">Studio</h3>
                        <p>Ufotable</p>
                        
                        <h3>Đạo diễn</h3>
                        <p>Haruo Sotozaki</p>
                    </div>
                    
                    <div class="tab-content" id="episodes">
                        <h3>Danh sách tập phim</h3>
                        <div class="episode-grid">
                            <div class="episode-card">
                                <div style="position: relative;">
                                    <img src="/api/placeholder/180/100" alt="Episode 1" class="episode-thumbnail">
                                    <div class="episode-number">Tập 1</div>
                                </div>
                                <div class="episode-info">
                                    <div class="episode-title">Cruetly - Tàn Khốc</div>
                                    <div class="episode-duration">25 phút</div>
                                </div>
                            </div>
                            <!-- Add more episodes as needed -->
                             <div class="episode-card">
                                <div style="position: relative;">
                                    <img src="/api/placeholder/180/100" alt="Episode 2" class="episode-thumbnail">
                                    <div class="episode-number">Tập 2</div>
                                </div>
                                <div class="episode-info">
                                    <div class="episode-title">Trainer Sakonji Urokodaki</div>
                                    <div class="episode-duration">25 phút</div>
                                </div>
                            </div>
                             <div class="episode-card">
                                <div style="position: relative;">
                                    <img src="/api/placeholder/180/100" alt="Episode 3" class="episode-thumbnail">
                                    <div class="episode-number">Tập 3</div>
                                </div>
                                <div class="episode-info">
                                    <div class="episode-title">Sabito and Makomo</div>
                                    <div class="episode-duration">25 phút</div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="tab-content" id="cast">
                        <h3>Dàn nhân vật & diễn viên lồng tiếng</h3>
                        <div class="cast-grid">
                            <div class="cast-card">
                                <img src="/api/placeholder/150/150" alt="Natsuki Hanae" class="cast-img">
                                <div class="cast-info">
                                    <div class="cast-name">Natsuki Hanae</div>
                                    <div class="cast-role">Tanjiro Kamado</div>
                                </div>
                            </div>
                             <div class="cast-card">
                                <img src="/api/placeholder/150/150" alt="Akari Kito" class="cast-img">
                                <div class="cast-info">
                                    <div class="cast-name">Akari Kitō</div>
                                    <div class="cast-role">Nezuko Kamado</div>
                                </div>
                            </div>
                             <div class="cast-card">
                                <img src="/api/placeholder/150/150" alt="Hiro Shimono" class="cast-img">
                                <div class="cast-info">
                                    <div class="cast-name">Hiro Shimono</div>
                                    <div class="cast-role">Zenitsu Agatsuma</div>
                                </div>
                            </div>
                            <!-- Add more cast members as needed -->
                        </div>
                    </div>
                    
                    <div class="tab-content" id="reviews">
                        <h3>Đánh giá & Nhận xét</h3>
                        <div class="comments-section">
                            <h4>Để lại nhận xét của bạn</h4>
                            <div class="comment-form">
                                <img src="/api/placeholder/50/50" alt="User Avatar">
                                <div class="comment-form-input">
                                    <textarea placeholder="Viết nhận xét của bạn..."></textarea>
                                    <div class="comment-form-actions">
                                        <button class="btn btn-primary">Đăng nhận xét</button>
                                    </div>
                                </div>
                            </div>
                             <!-- Example Comment -->
                            <div class="comment-list">
                                <div class="comment">
                                    <img src="/api/placeholder/50/50" alt="Commenter Avatar" class="comment-avatar">
                                    <div class="comment-content">
                                        <div class="comment-header">
                                            <span class="comment-author">AnimeFan123</span>
                                            <span class="comment-date">2 giờ trước</span>
                                        </div>
                                        <p class="comment-text">Phim hay quá! Hình ảnh đẹp, nội dung lôi cuốn. Hóng phần tiếp theo!</p>
                                        <div class="comment-actions">
                                            <a href="#">👍 Thích (15)</a>
                                            <a href="#">💬 Trả lời</a>
                                        </div>
                                    </div>
                                </div>
                            </div>
                             <!-- Add more comments as needed -->
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Recommended Section -->
            <div class="recommended-section">
                <div class="section-header">
                    <h2>Phim tương tự</h2>
                    <a href="#" class="view-all">Xem tất cả ▶</a>
                </div>
                <div class="movies-grid">
                    <!-- Placeholder for recommended movie cards -->
                    <div class="episode-card"> <!-- Reusing episode-card style for simplicity -->
                        <img src="/api/placeholder/180/270" alt="Similar Movie 1" class="episode-thumbnail" style="height: 270px;">
                        <div class="episode-info">
                            <div class="episode-title">Jujutsu Kaisen</div>
                            <div class="episode-duration">Hành động, Siêu nhiên</div>
                        </div>
                    </div>
                    <div class="episode-card">
                        <img src="/api/placeholder/180/270" alt="Similar Movie 2" class="episode-thumbnail" style="height: 270px;">
                        <div class="episode-info">
                            <div class="episode-title">Attack on Titan</div>
                            <div class="episode-duration">Hành động, Drama</div>
                        </div>
                    </div>
                    <div class="episode-card">
                        <img src="/api/placeholder/180/270" alt="Similar Movie 3" class="episode-thumbnail" style="height: 270px;">
                        <div class="episode-info">
                            <div class="episode-title">My Hero Academia</div>
                            <div class="episode-duration">Hành động, Shonen</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Video Player Modal -->
    <div class="modal" id="video-player-modal">
        <div class="modal-content" style="max-width: 900px; width: 90%; background-color: #000;">
            <button class="close-btn" onclick="closeModal('video-player-modal')" style="color: white; z-index: 10;">✕</button>
            <div style="padding: 56.25% 0 0 0; position: relative;">
                <div style="position: absolute; top: 0; left: 0; right: 0; bottom: 0; display: flex; align-items: center; justify-content: center; background-color: #000;">
                    <div style="text-align: center;">
                        <div class="loading-spinner"></div>
                        <p style="color: white; margin-top: 10px;">Đang tải video...</p>
                        <!-- Actual video player would go here, this is a placeholder -->
                        <img src="/api/placeholder/800/450" alt="Video Player Placeholder" style="max-width: 100%; display: block; margin: 20px auto;">
                        <div style="display: flex; align-items: center; justify-content: space-between; background: rgba(0,0,0,0.5); padding: 10px 20px; border-radius: 5px; margin-top: 10px;">
                            <button class="btn btn-outline" style="color: white;">Play</button>
                            <div style="color: white;">00:00 / 24:30</div>
                            <button class="btn btn-outline" style="color: white;">Full Screen</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Trailer Modal -->
    <div class="modal" id="trailer-modal">
        <div class="modal-content" style="max-width: 800px; width: 90%; background-color: #000;">
            <button class="close-btn" onclick="closeModal('trailer-modal')" style="color: white; z-index: 10;">✕</button>
            <div style="padding: 56.25% 0 0 0; position: relative;">
                 <!-- Actual video player (e.g., YouTube iframe) would go here -->
                <iframe style="position:absolute;top:0;left:0;width:100%;height:100%;" 
                        src="https://www.youtube.com/embed/VQGCKykIcqQ" 
                        title="YouTube video player" frameborder="0" 
                        allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" 
                        allowfullscreen>
                </iframe>
                <!-- Fallback if iframe doesn't load or for static display -->
                <!-- 
                <div style="position: absolute; top: 0; left: 0; right: 0; bottom: 0; display: flex; align-items: center; justify-content: center; background-color: #000;">
                    <div style="text-align: center;">
                        <img src="/api/placeholder/800/450" alt="Trailer Player Placeholder" style="max-width: 100%; display: block; margin: 0 auto;">
                        <div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);">
                            <div class="play-btn" style="width: 80px; height: 80px; opacity: 0.9;">▶</div>
                        </div>
                    </div>
                </div>
                -->
            </div>
        </div>
    </div>

    <!-- Community Discussion Section -->
    <section class="community-section">
        <div class="container">
            <div class="section-title">
                <h2>Thảo luận cộng đồng</h2>
            </div>
            <div class="community-container" style="max-width: 800px; margin: 20px auto 0;"> <!-- Reduced top margin -->
                <div class="community-filter" style="display: flex; justify-content: space-between; margin-bottom: 20px; align-items: center; flex-wrap: wrap; gap: 15px;">
                    <div class="filter-tabs" style="display: flex; gap: 10px; flex-wrap: wrap;"> <!-- Added flex-wrap -->
                        <div class="filter-tab active" style="padding: 8px 15px; border-radius: 20px; cursor: pointer; background-color: var(--primary-color); color: white; font-weight: 500;">Tất cả</div>
                        <div class="filter-tab" style="padding: 8px 15px; border-radius: 20px; cursor: pointer; background-color: var(--bg-secondary); color: var(--text-color);">Thảo luận</div>
                        <div class="filter-tab" style="padding: 8px 15px; border-radius: 20px; cursor: pointer; background-color: var(--bg-secondary); color: var(--text-color);">Hỏi đáp</div>
                        <div class="filter-tab" style="padding: 8px 15px; border-radius: 20px; cursor: pointer; background-color: var(--bg-secondary); color: var(--text-color);">Spoilers</div>
                    </div>
                    <div class="filter-sort" style="display: flex; align-items: center; gap: 10px;">
                        <span style="color: var(--text-secondary);">Sắp xếp:</span>
                        <select style="padding: 8px; border-radius: 5px; background-color: var(--bg-secondary); color: var(--text-color); border: 1px solid var(--light-color);">
                            <option>Mới nhất</option>
                            <option>Phổ biến nhất</option>
                            <option>Nóng nhất</option>
                        </select>
                    </div>
                </div>
                
                <div class="community-topics" style="margin-top: 30px;">
                    <!-- Topic 1 -->
                    <div class="topic-item" style="padding: 20px; border-radius: 10px; background-color: var(--bg-secondary); margin-bottom: 15px; transition: transform 0.3s, box-shadow 0.3s;">
                        <div class="topic-header" style="display: flex; justify-content: space-between; margin-bottom: 15px; flex-wrap: wrap; gap: 10px;">
                            <div class="topic-info" style="display: flex; align-items: center; gap: 15px;">
                                <img src="/api/placeholder/40/40" alt="User Avatar" style="width: 40px; height: 40px; border-radius: 50%;">
                                <div>
                                    <div style="font-weight: 500; color: var(--text-color);">MinhOtaku98</div>
                                    <div style="font-size: 0.8rem; color: var(--text-secondary);">3 giờ trước</div>
                                </div>
                            </div>
                            <div class="topic-tag" style="padding: 3px 10px; background-color: var(--primary-color); color: white; border-radius: 15px; font-size: 0.8rem;">Thảo luận</div>
                        </div>
                        <div class="topic-content">
                            <h4 style="margin-bottom: 10px; font-size: 1.1rem; color: var(--text-color);">Tanjiro có thực sự là nhân vật chính mạnh nhất trong anime?</h4>
                            <p style="color: var(--text-secondary); line-height: 1.5; margin-bottom: 15px;">So với nhiều nhân vật chính trong các anime khác, liệu Tanjiro có phải là một trong những nhân vật chính mạnh nhất không? Mình thấy cậu ấy phát triển rất nhanh nhưng vẫn có những giới hạn hợp lý...</p>
                            <div class="topic-stats" style="display: flex; gap: 20px; color: var(--text-secondary); font-size: 0.9rem;">
                                <span>👍 45 thích</span>
                                <span>💬 23 bình luận</span>
                                <a href="#" style="color: var(--primary-color); margin-left: auto; text-decoration: none;">Xem chi tiết ▶</a>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Topic 2 -->
                    <div class="topic-item" style="padding: 20px; border-radius: 10px; background-color: var(--bg-secondary); margin-bottom: 15px; transition: transform 0.3s, box-shadow 0.3s;">
                        <div class="topic-header" style="display: flex; justify-content: space-between; margin-bottom: 15px; flex-wrap: wrap; gap: 10px;">
                            <div class="topic-info" style="display: flex; align-items: center; gap: 15px;">
                                <img src="/api/placeholder/40/40" alt="User Avatar" style="width: 40px; height: 40px; border-radius: 50%;">
                                <div>
                                    <div style="font-weight: 500; color: var(--text-color);">AnimeQueen22</div>
                                    <div style="font-size: 0.8rem; color: var(--text-secondary);">1 ngày trước</div>
                                </div>
                            </div>
                            <div class="topic-tag" style="padding: 3px 10px; background-color: #e74c3c; color: white; border-radius: 15px; font-size: 0.8rem;">Spoilers</div>
                        </div>
                        <div class="topic-content">
                            <h4 style="margin-bottom: 10px; font-size: 1.1rem; color: var(--text-color);">Về kết thúc của arc Vô Hạn Thành - Spoilers!</h4>
                            <p style="color: var(--text-secondary); line-height: 1.5; margin-bottom: 15px;">SPOILER WARNING! Kết thúc của arc Vô Hạn Thành đã làm mình bất ngờ. Ai có thể ngờ rằng ... [Nội dung đã ẩn]</p>
                            <div class="topic-stats" style="display: flex; gap: 20px; color: var(--text-secondary); font-size: 0.9rem;">
                                <span>👍 128 thích</span>
                                <span>💬 76 bình luận</span>
                                <a href="#" style="color: var(--primary-color); margin-left: auto; text-decoration: none;">Xem chi tiết ▶</a>
                            </div>
                        </div>
                    </div>
                     <!-- Add more topics as needed -->
                </div>
                
                <div style="text-align: center; margin-top: 30px;">
                    <button class="btn btn-outline" style="padding: 10px 20px;">Xem thêm chủ đề</button>
                </div>
                
                <div class="start-topic" style="margin-top: 40px; background-color: var(--bg-secondary); border-radius: 10px; padding: 20px;">
                    <h3 style="margin-bottom: 15px; font-size: 1.2rem; color: var(--text-color);">Bắt đầu một chủ đề mới</h3>
                    <textarea placeholder="Chia sẻ suy nghĩ của bạn về Demon Slayer..." style="width: 100%; padding: 15px; border-radius: 8px; background-color: var(--bg-color); color: var(--text-color); border: 1px solid var(--light-color); resize: none; height: 100px; margin-bottom: 15px;"></textarea>
                    <div style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 15px;">
                        <select style="padding: 8px 15px; border-radius: 5px; background-color: var(--bg-color); color: var(--text-color); border: 1px solid var(--light-color);">
                            <option>Chọn chủ đề</option>
                            <option>Thảo luận</option>
                            <option>Hỏi đáp</option>
                            <option>Spoilers</option>
                            <option>Fan Art</option>
                        </select>
                        <button class="btn btn-primary">Đăng chủ đề</button>
                    </div>
                </div>
            </div>
        </div>
    </section>

      <iframe 
        id="footer-iframe"
        src="../footer.html" 
        style="width: 100%; border: none;" 
        onload="adjustIframeHeight(this);"
        title="Footer Information"
        loading="lazy">
    </iframe>

    <script src="./script.js"></script>
    <script>
        // Tab functionality
        document.querySelectorAll('.tab').forEach(tab => {
            tab.addEventListener('click', function() {
                document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                this.classList.add('active');
                
                document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
                const tabId = this.getAttribute('data-tab');
                document.getElementById(tabId).classList.add('active');
            });
        });
        
        // Play trailer button
        document.querySelector('.play-trailer-btn').addEventListener('click', function() {
            openModal('trailer-modal');
        });
        
        // Episode cards
        document.querySelectorAll('.episode-card').forEach(card => {
            card.addEventListener('click', function() {
                // For actual functionality, you'd pass episode data to the modal
                openModal('video-player-modal');
            });
        });
        
        // "Xem ngay" button
        document.querySelector('.btn-lg.btn-primary').addEventListener('click', function() {
             // For actual functionality, you'd likely go to the first episode or latest
            openModal('video-player-modal');
        });

        // Modal functions (should be in script.js but included here if script.js is minimal)
        function openModal(modalId) {
            document.getElementById(modalId).style.display = 'flex';
            document.body.style.overflow = 'hidden'; // Prevent background scrolling
        }

        function closeModal(modalId) {
            const modal = document.getElementById(modalId);
            modal.style.display = 'none';
            document.body.style.overflow = ''; // Restore scrolling

            // If it's a video modal, pause the video
            const iframe = modal.querySelector('iframe');
            if (iframe && iframe.contentWindow) {
                 // For YouTube, postMessage API is more reliable
                iframe.contentWindow.postMessage('{"event":"command","func":"pauseVideo","args":""}', '*');
                // Also try to reset src to stop loading/playing
                const originalSrc = iframe.src;
                iframe.src = ''; // Detach
                iframe.src = originalSrc; // Reattach (usually stops playback)
            }
        }
        
        // Close modal on escape key
        window.addEventListener('keydown', function(event) {
            if (event.key === 'Escape') {
                document.querySelectorAll('.modal').forEach(modal => {
                    if (modal.style.display === 'flex') {
                        closeModal(modal.id);
                    }
                });
            }
        });

        // Close modal when clicking outside of modal-content
        document.querySelectorAll('.modal').forEach(modal => {
            modal.addEventListener('click', function(event) {
                if (event.target === modal) { // Clicked on the modal backdrop
                    closeModal(modal.id);
                }
            });
        });


        // Iframe height and theme sync (should be in script.js)
        function adjustIframeHeight(iframe) {
            try {
                const body = iframe.contentWindow.document.body;
                const html = iframe.contentWindow.document.documentElement;
                const height = Math.max(body.scrollHeight, body.offsetHeight, html.clientHeight, html.scrollHeight, html.offsetHeight);
                iframe.style.height = height + 'px';

                // Send initial theme to iframe
                 if (iframe.id === 'header-iframe' || iframe.id === 'footer-iframe') {
                    const currentTheme = document.body.classList.contains('light-mode') ? 'light' : 'dark';
                    iframe.contentWindow.postMessage({ type: 'themeChange', theme: currentTheme }, '*');
                }

            } catch (e) {
                console.warn("Could not adjust iframe height or sync theme, possibly due to cross-origin restrictions if not on a server.", e);
            }
        }
        
        function syncThemeWithIframe() {
            const headerIframe = document.getElementById('header-iframe');
            const footerIframe = document.getElementById('footer-iframe');
            const currentTheme = document.body.classList.contains('light-mode') ? 'light' : 'dark';

            if (headerIframe && headerIframe.contentWindow) {
                headerIframe.contentWindow.postMessage({ type: 'themeChange', theme: currentTheme }, '*');
            }
            if (footerIframe && footerIframe.contentWindow) {
                footerIframe.contentWindow.postMessage({ type: 'themeChange', theme: currentTheme }, '*');
            }
        }

        // Listen for theme changes from header iframe (if theme toggle is in header)
        window.addEventListener('message', function(event) {
            // Check origin for security if on a live domain
            // if (event.origin !== 'expected_origin') return;

            if (event.data.type === 'themeToggle') {
                document.body.classList.toggle('light-mode');
                document.body.classList.toggle('dark-mode');
                localStorage.setItem('theme', document.body.classList.contains('light-mode') ? 'light' : 'dark');
                syncThemeWithIframe(); // Sync with footer and potentially other iframes
            } else if (event.data.type === 'requestHeightUpdate') {
                 const iframeToUpdate = document.getElementById(event.data.iframeId);
                 if (iframeToUpdate) {
                    adjustIframeHeight(iframeToUpdate);
                 }
            } else if (event.data.type === 'scrollToTop') {
                window.scrollTo({ top: 0, behavior: 'smooth' });
            }
        });

        // Initial theme load
        document.addEventListener('DOMContentLoaded', () => {
            const savedTheme = localStorage.getItem('theme') || 'dark'; // Default to dark
            if (savedTheme === 'light') {
                document.body.classList.remove('dark-mode');
                document.body.classList.add('light-mode');
            } else {
                document.body.classList.remove('light-mode');
                document.body.classList.add('dark-mode');
            }
            // Initial sync for iframes that might load after DOMContentLoaded but before their own onload
            // The onload adjustIframeHeight already calls syncThemeWithIframe
        });

        // Adjust margin for fixed header after it loads
        const headerIframe = document.getElementById('header-iframe');
        if (headerIframe) {
            headerIframe.addEventListener('load', function() {
                try {
                    const headerHeight = this.contentWindow.document.body.offsetHeight;
                    document.querySelector('.movie-detail-hero').style.marginTop = headerHeight + 'px';
                } catch (e) {
                    // Fallback if accessing iframe content fails
                    document.querySelector('.movie-detail-hero').style.marginTop = '70px'; // Approx height
                    console.warn("Could not get header height from iframe for margin adjustment.", e);
                }
            });
        }

    </script>
</body>
</html>